# ZDT闭环步进电机通讯协议

本文档是ZDT_X42S第二代闭环步进电机的通讯协议手册，详细介绍了主控与电机之间的通讯命令格式。

## 第5章 通讯命令

### 5.0 CAN通讯协议说明

#### 5.0.1 CAN协议帧结构

ZDT闭环步进电机支持CAN总线通讯协议，采用扩展帧格式。

**CAN帧格式：**

| 字段 | 说明 |
| --- | --- |
| 扩展帧ID | (Addr << 8) \| Packet Code |
| DLC | 数据长度 |
| Data | 数据域（功能码 + 数据 + 校验码） |

**扩展帧ID计算：**
- Addr：电机地址（1-255）
- Packet Code：分包代码
- 扩展帧ID = (地址 << 8) \| 分包代码

#### 5.0.2 CAN分包传输机制

当通讯数据超过单个CAN帧最大长度时，需要采用分包传输机制。

**重要说明：**
- **每一个CAN分包的第一字节数据都是command code（功能码）**
- 不是只有第一个分包包含功能码，而是每个分包都需要包含功能码
- 分包代码用于标识分包的序号和类型

**主机发送格式（主机→电机）：**

| 扩展帧ID | 字节1 | 字节2 | 字节3 | ... | 字节N | 校验码 |
| --- | --- | --- | --- | --- | --- | --- |
| (Addr << 8) \| Packet Code | 功能码 | 数据1 | 数据2 | ... | 数据N | 0x6B/XOR/CRC8 |

**电机返回格式（电机→主机）：**

| 扩展帧ID | 字节1 | 字节2 | 校验码 |
| --- | --- | --- | --- |
| (Addr << 8) \| Packet Code | 功能码 | 返回数据 | 0x6B/XOR/CRC8 |

**返回数据说明：**
- 02：表示接收的命令正确
- E2：表示接收的命令参数错误（数据范围不满足或条件不满足，触发低压警告、堵转保护、过流过热保护等）
- EE：表示接收的命令格式错误
- 9F：表示接收动作执行完成命令（电机主动返回）
  - 力矩模式夹爪夹紧返回：F5 + 9F + 校验码
  - 到位返回：FD + 9F + 校验码
  - 回零完成：9A + 9F + 校验码

#### 5.0.3 校验码类型

支持三种校验方式：
- **0x6B**：固定校验码（默认）
- **XOR**：XOR校验
- **CRC8**：CRC8校验
- **Modbus-RTU**：Modbus-RTU协议CRC16校验

校验码计算方式详见文末附录。

#### 5.0.4 分包代码定义

分包代码（Packet Code）用于标识不同的分包类型和序号：
- 0x00：第1个分包
- 0x01：第2个分包
- 0x02：第3个分包
- ...：依此类推

### 5.1 通讯命令说明

#### 5.1.1 命令后缀说明
命令后缀带有（X）为X固件命令，带有（E）为Emm固件命令，无后缀以及带有（X42S/Y42）都是两种固件通用命令。

#### 5.1.2 两种固件部分命令差异

| 命令 | 差异说明 |
| --- | --- |
| 1.力矩模式 | Emm固件无力矩模式，X固件有 |
| 2.速度模式 | 命令格式不同 |
| 3.位置模式 | 命令格式不同，X固件有两种位置模式 |
| 4.读取系统状态参数 | 命令格式不同 |
| 5.修改系统状态参数 | 命令格式不同 |
| 6.读取驱动配置参数 | 主机发送的命令格式一样，电机返回格式不同 |
| 7.修改驱动配置参数 | 命令格式不同 |
| 8.存储一组速度参数，上电自动运行 | 命令格式不同 |

**注意：** 两种固件的命令中电机位置角度/误差的格式不同。除上述命令外，两种固件其他命令格式相同。

#### 5.1.3 位置模式命令打断说明
不管是X固件还是Emm固件，X42S/Y42都支持位置模式命令打断功能，即在上一条位置模式命令还在运行过程中，可以发送新的位置模式命令去改变速度、加速度和位置等，并且新命令参数实时更新、平滑过渡。

### 5.2 触发动作命令

#### 5.2.1 触发编码器校准

**主机发送（主机→电机）**

| 地址 | 功能码 | 辅助码 | 校验码 |
| --- | --- | --- | --- |
| Addr | 06 | 45 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | 06 | 02/E2/EE(参考第4章节说明) | 6B |

**说明：** 例如，发送 `01 06 45 6B`，正确返回 `01 06 02 6B`，闭环模式触发校准编码器，电机将缓慢正转一圈然后反转一圈对编码器进行线性化校准，提高精度**（不校准编码器将会有±0.75度~±1.5度的误差）**，开环模式校准将返回E2错误码。

#### 5.2.2 重启电机（X42S/Y42）

**主机发送（主机→电机）**

| 地址 | 功能码 | 辅助码 | 校验码 |
| --- | --- | --- | --- |
| Addr | 08 | 97 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | 08 | 02/E2/EE(参考第4章节说明) | 6B |

**说明：** 例如，发送 `01 08 97 6B`，正确返回 `01 08 **02** 6B`，闭环电机将复位重启。

**注意：** **如果有接入"掉电记录"电池，复位重启电机位置不丢失。**

#### 5.2.3 将当前位置角度清零

**主机发送（主机→电机）**

| 地址 | 功能码 | 辅助码 | 校验码 |
| --- | --- | --- | --- |
| Addr | 0A | 6D | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | 0A | 02/E2/EE(参考第4章节说明) | 6B |

**说明：** 例如，发送 `01 0A 6D 6B`，正确返回 `01 0A 02 6B`，将清零当前位置角度。

#### 5.2.4 解除堵转/过热/过流保护

**主机发送（主机→电机）**

| 地址 | 功能码 | 辅助码 | 校验码 |
| --- | --- | --- | --- |
| Addr | 0E | 52 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | 0E | 02/E2/EE(参考第4章节说明) | 6B |

**说明：** 例如，发送 `01 0E 52 6B`，正确返回 `01 0E 02 6B`，将解除堵转/过热/过流保护。

#### 5.2.5 恢复出厂设置

**主机发送（主机→电机）**

| 地址 | 功能码 | 辅助码 | 校验码 |
| --- | --- | --- | --- |
| Addr | 0F | 5F | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | 0F | 02/E2/EE(参考第4章节说明) | 6B |

**说明：** 例如，发送 `01 0F 5F 6B`，正确返回 `01 0F 02 6B`，将恢复出厂设置，绿灯和蓝灯交替闪烁，此时需要断电重新上电，再空载校准电机编码器。

### 5.3 运动控制命令

#### 5.3.1 多电机命令（X42S/Y42）

**主机发送（主机→电机）**

| 字节1 | 字节2 | 字节3 | 字节4 | 字节5 | 字节6 | 字节7 | 字节n |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 地址 | 功能码 | 字节长度 | 命令1 | 命令2 | 命令3 | ... | 校验码 |
| 00 | AA | 总字节数 | 01 36 6B | 02 36 6B | 03 36 6B | ... | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | AA | 根据不同命令返回相应的数据 | 6B |

**说明：**
1. 所有的运动命令只有地址1电机会回复确认收到命令，避免造成总线冲突
2. 多电机命令中，位置模式运动命令中的多机同步标志用于控制是否返回到位命令：地址+功能码+9F+校验码，0为到位不返回，1为到位返回
3. 多电机命令中含有读取参数命令的，要避开地址1返回的确认收到命令（方法：可设置Response菜单为None/Reached，或者改为其他地址等）
4. Modbus-RTU协议暂不支持多电机命令

**示例：** 以Emm固件为示例：假设总线上分别有地址1、2、3、4四个电机，假设需要：
- 电机2：速度1500RPM，加速度为8，相对位置运动-3600.0°，到位不返回
- 电机3：速度1000RPM，加速度为10，绝对位置运动7200.0°，到位返回
- 电机4：读取实时位置角度

发送多电机命令为：
```
00 AA 00 22 02 FD 01 05 DC 08 00 00 7D 00 00 00 6B 03 FD 00 03 E8 0A 00 00 FA 00 01 01 6B 04 36 6B 6B
```

参数说明：
- `00` = 广播地址
- `AA` = 功能码
- `0022` = 总字节数为34
- `6B` = 校验码
- `02 FD 01 05 DC 08 00 00 7D 00 00 00 6B` = 电机2执行位置模式运动命令
- `03 FD 00 03 E8 0A 00 00 FA 00 01 01 6B` = 电机3执行位置模式运动命令
- `04 36 6B` = 电机4执行读取实时位置命令，返回实时位置信息

**注意：** 电机2到位后不返回命令，电机3到位后返回命令。

#### 5.3.2 电机使能控制

**主机发送（主机→电机）**

| 地址 | 功能码 | 辅助码 | 使能状态 | 同步标志 | 校验码 |
| --- | --- | --- | --- | --- | --- |
| Addr | F3 | AB | 00/01 | 00/01 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | F3 | 02/E2/EE(参考第4章节说明) | 6B |

**参数说明：**
- 使能状态：00/01分别表示不使能/使能(注：不使能电机会松轴，轴能拧动)
- 同步标志：00/01分别表示立即执行/先缓存当前命令，参考3.5.2小节说明

**示例：** 例如，发送 `01 F3 AB 01 00 6B`，正确返回 `01 F3 02 6B`，使能电机（锁轴）。

#### 5.3.3 力矩模式控制（X）

**主机发送（主机→电机）**

| 字节1 | 字节2 | 字节3 | 字节4-字节7 | 字节8 | 字节9 |
| --- | --- | --- | --- | --- | --- |
| 地址 | 功能码 | 符号 | 斜率（加速度） | 电流 | 同步标志 校验码 |
| Addr | F5 | 00/01 | 0000-FFFF | 0000-1388 | 00/01 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | F5 | 02/9F/E2/EE(参考第4章节说明) | 6B |

**说明：** 参数解析见下面的"5.3.4 力矩模式限速控制（X）"命令说明。

#### 5.3.4 力矩模式限速控制（X）

**主机发送（主机→电机）**

| 字节1 | 字节2 | 字节3 | 字节4 | 字节5 | 字节6 | 字节7 | 字节8 | 字节9 | 字节10 | 字节11 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 地址 | 功能码 | 符号 | 斜率（加速度） | 电流 | 同步标志 | 最大速度 | 校验码 |
| Addr | C5 | 00/01 | 0000-FFFF | 0000-1388 | 00/01 | 0000-7E30 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | C5 | 02/9F/E2/EE(参考第4章节说明) | 6B |

**参数说明：**
- 此命令是在"5.3.3 力矩模式控制（X）"命令基础上增加了最大速度限制
- 符号：00/01分别表示CW/CCW，即分别表示电流值的正数/负数
- 斜率（加速度）：范围为0000-FFFF，即0-65535mA/S（毫安每秒）
- 电流：范围为0000-1388，即0-5000mA（毫安）
- 同步标志：00/01分别表示立即执行/先缓存当前命令，参考3.5.2小节说明
- 最大速度：范围为0000-7E30，即0-30000，保留一位小数，即0-3000.0RPM

**示例：** 例如，发送 `01 C5 01 00 C8 02 58 00 0F A0 6B`，命令正确返回 `01 C5 02 6B`，电机以符号CCW，斜率200mA/S，电流600mA，最大速度400.0RPM，进行运动。

**特别注意：** 力矩模式仅X固件有，Emm固件没有。力矩模式控制，电机将会以**给定电流**和**给定最大速度**的**最小值**进行一直旋转，如果**给定电流**太大，电机将会以**给定最大速度**运行，运行过程中将达不到**给定电流**，而是在夹爪夹紧(堵住)后达到**给定电流**，并维持给定电流力矩，适合**电动夹爪、自动收线**等应用。

#### 5.3.5 速度模式控制（X）

**主机发送（主机→电机）**

| 字节1 | 字节2 | 字节3 | 字节4-字节7 | 字节8 | 字节9 |
| --- | --- | --- | --- | --- | --- |
| 地址 | 功能码 | 方向 | 加速度 | 速度 | 同步标志 校验码 |
| Addr | F6 | 00/01 | 0000-FFFF | 0000-7E30 | 00/01 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | F6 | 02/E2/EE(参考第4章节说明) | 6B |

**说明：** 参数解析见下面的"5.3.6 速度模式限电流控制（X）"命令说明。

#### 5.3.6 速度模式限电流控制（X）

**主机发送（主机→电机）**

| 字节1 | 字节2 | 字节3 | 字节4 | 字节5 | 字节6 | 字节7 | 字节8 | 字节9 | 字节10 | 字节11 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 地址 | 功能码 | 符号 | 加速度 | 速度 | 同步标志 | 最大电流 | 校验码 |
| Addr | C6 | 00/01 | 0000-FFFF | 0000-7E30 | 00/01 | 0000-1388 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | C6 | 02/E2/EE(参考第4章节说明) | 6B |

**参数说明：**
- 此命令是在"5.3.5 速度模式控制（X）"基础上增加了最大电流限制
- 方向：00/01分别表示CW/CCW
- 加速度：范围为0000-FFFF，即0-65535RPM/S（转每分钟每秒）
- 速度：范围为0000-7E30，即0-30000，保留一位小数，即0-3000.0RPM
- 同步标志：00/01分别表示立即执行/先缓存当前命令，参考3.5.2小节说明
- 最大电流：范围为0000-1388，即0-5000mA（毫安）

**示例：** 例如，发送 `01 C6 01 03 E8 4E 20 00 07 D0 6B`，命令正确返回 `01 C6 02 6B`，电机以方向CCW，加速度1000RPM/S，速度2000.0RPM，最大电流限制为2000mA，进行运动。

#### 5.3.7 速度模式控制（Emm）

**主机发送（主机→电机）**

| 字节1 | 字节2 | 字节3 | 字节4 | 字节5 | 字节6 | 字节7 | 字节8 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 地址 | 功能码 | 方向 | 速度 | 加速度 | 同步标志 | 校验码 |
| Addr | F6 | 00/01 | 0000-0BB8 | 00-FF | 00/01 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | F6 | 02/E2/EE(参考第4章节说明) | 6B |

**参数说明：**
- 方向：00/01分别表示CW/CCW
- 速度：范围为0000-0BB8，即0-3000RPM
- 加速度：范围为00-FF，即0-255档位，加速度的计算公式如下
  1. 加速度为0表示不使用曲线加减速，直接按照设定的速度启动和运行
  2. 加速度不为0，则曲线加减速时间计算公式为：`t2 - t1 = (256 - acc) * 50(us)，Vt2 = Vt1 + 1(RPM)`（acc为加速度，Vt1为t1时刻的转速，Vt2为t2时刻的转速）
  3. 说明：公式表示每隔(256 - acc)个50us增加/减少1RPM(转每分钟)，比如，当设定加速度为100时，就是每隔((256 - 100) * 50us) = 7800us的时间增加/减少1RPM
  4. 特别注意：加速度acc＝0时是直接启动，acc≠0时，根据上述公式计算加减速时间，此时acc值越大，加速时间越短，则加速越快
- 同步标志：00/01分别表示立即执行/先缓存当前命令，参考3.5.2小节说明

**示例：** 例如，发送 `01 F6 01 05 DC 0A 00 6B`，命令正确返回 `01 F6 02 6B`，电机以方向CCW，速度1500RPM，加速度10档位，进行运动。

#### 5.3.8 直通限速位置模式控制（X）

**主机发送（主机→电机）**

| 字节1 | 字节2 | 字节3 | 字节4 | 字节5 | 字节6 | 字节7 | 字节8 | 字节9 | 字节10 | 字节11 | 字节12 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 地址 | 功能码 | 方向 | 速度 | 位置角度 | 运动模式 | 同步标志 | 校验码 |
| Addr | FB | 00/01 | 0000-7E30 | 00000000-FFFFFFFF | 00/01/02 | 00/01 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | FB | 02/9F/E2/EE(参考第4章节说明) | 6B |

**说明：** 参数解析见下面的"5.3.9 直通限速位置模式限电流控制（X）"命令说明。

#### 5.3.9 直通限速位置模式限电流控制（X）

**主机发送（主机→电机）**

| 字节1 | 字节2 | 字节3 | 字节4 | 字节5 | 字节6 | 字节7 | 字节8 | 字节9 | 字节10 | 字节11 | 字节12 | 字节13 | 字节14 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 地址 | 功能码 | 方向 | 速度 | 位置角度 | 运动模式 | 同步标志 | 最大电流 | 校验码 |
| Addr | CB | 00/01 | 0000-7530 | 00000000-FFFFFFFF | 00/01/02 | 00/01 | 0000-1388 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | CB | 02/9F/E2/EE(参考第4章节说明) | 6B |

**参数说明：**
- 此命令是在"5.3.8 直通限速位置模式控制（X）"基础上增加了最大电流限制
- 方向：00/01分别表示CW/CCW
- 速度：范围为0000-7E30，即0-30000，保留一位小数，即0-3000.0RPM
- 位置角度：范围为00000000-FFFFFFFF，即0-4294967295，保留一位小数，值为1表示0.1°，值为10表示1°，以此类推
- 运动模式：00/01/02分别表示相对上一输入目标位置进行相对位置运动/相对坐标零点进行绝对位置运动/相对当前实时位置进行相对位置运动
- 同步标志：00/01分别表示立即执行/先缓存当前命令，参考3.5.2小节说明
- 最大电流：范围为0000-1388，即0-5000mA（毫安）

**示例：** 例如，发送 `01 CB 01 4E 20 00 00 8C A0 00 00 07 D0 6B`，正确返回 `01 CB 02 6B`，电机以方向CCW，速度2000.0RPM，相对上一输入目标位置相对运动3600.0°，最大电流限制为2000mA，进行运动。

#### 5.3.10 梯形曲线加减速位置模式控制（X）

**主机发送（主机→电机）**

| 字节1 | 字节2 | 字节3 | 字节4 | 字节5 | 字节6 | 字节7 | 字节8 | 字节9 | 字节10-字节16 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 地址 | 功能码 | 方向 | 加速加速度 | 减速加速度 | 最大速度 | 位置角度 | 运动模式 | 同步标志 | 校验码 |
| Addr | FD | 00/01 | 0000-FFFF | 0000-FFFF | 0000-7530 | 00000000-FFFFFFFF | 00/01/02 | 00/01 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | FD | 02/9F/E2/EE(参考第4章节说明) | 6B |

**说明：** 参数解析见下面的"5.3.11 梯形曲线加减速位置模式限电流控制（X）"说明。

#### 5.3.11 梯形曲线加减速位置模式限电流控制（X）

**主机发送（主机→电机）**

| 字节1 | 字节2 | 字节3 | 字节4 | 字节5 | 字节6 | 字节7 | 字节8 | 字节9 | 字节10-字节18 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 地址 | 功能码 | 方向 | 加速加速度 | 减速加速度 | 最大速度 | 位置角度 | 运动模式 | 同步标志 | 最大电流 | 校验码 |
| Addr | CD | 00/01 | 0000-FFFF | 0000-FFFF | 0000-7530 | 00000000-FFFFFFFF | 00/01/02 | 00/01 | 0000-1388 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | CD | 02/9F/E2/EE(参考第4章节说明) | 6B |

**参数说明：**
- 此命令是在"5.3.10 梯形曲线加减速位置模式控制（X）"基础上增加了最大电流限制
- 方向：00/01分别表示CW/CCW
- 加速加速度：范围为0000-FFFF，即0-65535RPM/S（转每分钟每秒）
- 减速加速度：范围为0000-FFFF，即0-65535RPM/S（转每分钟每秒）
- 最大速度：范围为0000-7E30，即0-30000，保留一位小数，即0-3000.0RPM
- 位置角度：范围为00000000-FFFFFFFF，即0-4294967295，保留一位小数，值为1表示0.1°，值为10表示1°，以此类推
- 运动模式：00/01/02分别表示相对上一输入目标位置进行相对位置运动/相对坐标零点进行绝对位置运动/相对当前实时位置进行相对位置运动
- 同步标志：00/01分别表示立即执行/先缓存当前命令，参考3.5.2小节说明
- 最大电流：范围为0000-1388，即0-5000mA（毫安）

**示例：** 例如，发送 `01 CD 01 01 FF 01 FA 27 10 00 00 8C A0 00 00 07 D0 6B`，正确返回 `01 CD 02 6B`，电机以方向CCW，加速加速度511RPM/S，减速加速度506RPM/S，速度1000.0RPM，相对上一输入目标位置相对运动3600.0°，最大电流限制为2000mA，进行运动。

#### 5.3.12 位置模式控制（Emm）

**主机发送（主机→电机）**

| 字节1 | 字节2 | 字节3 | 字节4 | 字节5 | 字节6 | 字节7 | 字节8 | 字节9 | 字节10 | 字节11 | 字节12 | 字节13 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 地址 | 功能码 | 方向 | 速度 | 加速度 | 脉冲数 | 运动模式 | 同步标志 | 校验码 |
| Addr | FD | 00/01 | 0000-0BB8 | 00-FF | 00000000-FFFFFFFF | 00/01/02 | 00/01 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | FD | 02/9F/E2/EE(参考第4章节说明) | 6B |

**参数说明：**
- 方向：00/01分别表示CW/CCW
- 速度：范围为0000-0BB8，即0-3000RPM
- 加速度：范围为00-FF，即0-255档位，加速度的计算公式如下
  1. 加速度为0表示不使用曲线加减速，直接按照设定的速度启动和运行
  2. 加速度不为0，则曲线加减速时间计算公式为：`t2 - t1 = (256 - acc) * 50(us)，Vt2 = Vt1 + 1(RPM)`（acc为加速度，Vt1为t1时刻的转速，Vt2为t2时刻的转速）
  3. 说明：公式表示每隔(256 - acc)个50us增加/减少1RPM(转每分钟)，比如，当设定加速度为100时，就是每隔((256 - 100) * 50us) = 7800us的时间增加/减少1RPM
  4. 特别注意：加速度acc＝0时是直接启动，acc≠0时，根据上述公式计算加减速时间，此时acc值越大，加速时间越短，则加速越快
- 脉冲数：默认1.8°步进电机，细分16，每个脉冲电机转1.8°/16 = 0.1125°，即发送3200个脉冲电机转一圈360°，以此进行计算
- 运动模式：00/01/02分别表示相对上一输入目标位置进行相对位置运动/相对坐标零点进行绝对位置运动/相对当前实时位置进行相对位置运动
- 同步标志：00/01分别表示立即执行/先缓存当前命令，参考3.5.2小节说明

**示例：** 例如，发送 `01 FD 01 05 DC 00 00 00 7D 00 00 00 6B`，正确返回 `01 FD 02 6B`，电机以方向CCW，速度1500RPM，加速度0档位，相对运动32000个脉冲(10圈)。

#### 5.3.13 立即停止

**主机发送（主机→电机）**

| 地址 | 功能码 | 辅助码 | 同步标志 | 校验码 |
| --- | --- | --- | --- | --- |
| Addr | FE | 98 | 00/01 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | FE | 02/E2/EE(参考第4章节说明) | 6B |

**参数说明：**
- 同步标志：00/01分别表示立即执行/先缓存当前命令，参考3.5.2小节说明

**示例：** 例如，发送 `01 FE 98 00 6B`，正确返回 `01 FE 02 6B`，立即停止电机。

#### 5.3.14 触发多机同步运动

**主机发送（主机→电机）**

| 地址 | 功能码 | 辅助码 | 校验码 |
| --- | --- | --- | --- |
| Addr | FF | 66 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | FF | 02/E2/EE(参考第4章节说明) | 6B |

**说明：** 例如，发送 `00 FF 66 6B`，正确返回 `01 FF 02 6B`，以广播地址0发送多机同步运动命令，将使缓存了命令的电机(发送过同步标志为01的命令)同步开始执行缓存的命令，无缓存命令的电机不会动作。

### 5.4 原点回零命令

#### 5.4.1 设置单圈回零的零点位置

**主机发送（主机→电机）**

| 地址 | 功能码 | 辅助码 | 是否存储 | 校验码 |
| --- | --- | --- | --- | --- |
| Addr | 93 | 88 | 00/01 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | 93 | 02/E2/EE(参考第4章节说明) | 6B |

**参数说明：**
- 是否存储：00/01分别表示不存储/存储，存储后数据掉电不丢失

**示例：** 例如，发送 `01 93 88 01 6B`，正确返回 `01 93 02 6B`，将当前位置设置为单圈回零的零点位置，且存储在电机上。

**注意：** 该零点位置是单圈的范围内。

#### 5.4.2 触发回零

**主机发送（主机→电机）**

| 地址 | 功能码 | 回零模式 | 同步标志 | 校验码 |
| --- | --- | --- | --- | --- |
| Addr | 9A | 00-05 | 00/01 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | 9A | 02/12/9F/E2/EE(参考第4章) | 6B |

**参数说明：**
- 回零模式：默认值为00，即单圈就近回零模式
  - 00：单圈就近回零
  - 01：单圈方向回零
  - 02：无限位碰撞回零
  - 03：限位回零
  - 04：回到绝对位置坐标零点
  - 05：回到上次掉电位置角度
- 同步标志：00/01分别表示立即执行/先缓存当前命令，参考3.5.2小节说明

**示例：** 例如，发送 `01 9A 02 00 6B`，正确返回 `01 9A 02 6B`，触发无限位碰撞回零。

**特别注意：** 接线和设置参考**"3.2 原点回零"**小节相应回零模式的说明操作。

#### 5.4.3 强制中断并退出回零操作

**主机发送（主机→电机）**

| 地址 | 功能码 | 辅助码 | 校验码 |
| --- | --- | --- | --- |
| Addr | 9C | 48 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | 9C | 02/E2/EE(参考第4章节说明) | 6B |

**说明：** 例如，发送 `01 9C 48 6B`，正确返回 `01 9C 02 6B`，在回零过程中可中断回零。

#### 5.4.4 读取回零状态标志

**主机发送（主机→电机）**

| 地址 | 功能码 | 校验码 |
| --- | --- | --- |
| Addr | 3B | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | bit7 | bit6 | bit5 | bit4 | bit3 | bit2 | bit1 | bit0 | 校验码 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Addr | 3B | 保留 | 保留 | Ocp_TF | Otp_TF | Org_CF | Org_SF | Cal_Rdy | Enc_Rdy | 6B |

**参数说明：**
- Ocp_TF：过流保护标志，0/1分别表示没触发/触发了过流保护
- Otp_TF：过热保护标志，0/1分别表示没触发/触发了过热保护
- Org_CF/Org_SF：回零失败标志/正在回零标志
  - 默认状态：回零失败标志Org_CF为0，正在回零标志Org_SF为0
  - 正在回零：回零失败标志Org_CF为0，正在回零标志Org_SF为1
  - 回零失败：回零失败标志Org_CF为1，正在回零标志Org_SF为0
  - 回零成功：回零失败标志Org_CF为0，正在回零标志Org_SF为0
- Cal_Rdy：校准表就绪标志，0/1分别表示未校准/已校准
- Enc_Rdy：编码器就绪标志，0/1分别表示编码器异常/编码器正常

**示例：** 例如，发送 `01 3B 6B` 读取回零状态标志，假设返回 `01 3B 03 6B`，其中03为回零状态标志，03二进制数为00000011，即Cal_Rdy和Enc_Rdy为1，其余为0。

**编程判断：**
```c
// 判断每个标志位的状态
if(回零状态标志 & 0x01) { Enc_Rdy = true; } else { Enc_Rdy = false; }
if(回零状态标志 & 0x02) { Cal_Rdy = true; } else { Cal_Rdy = false; }
if(回零状态标志 & 0x04) { Org_SF = true; } else { Org_SF = false; }
if(回零状态标志 & 0x08) { Org_CF = true; } else { Org_CF = false; }
if(回零状态标志 & 0x10) { Otp_TF = true; } else { Otp_TF = false; }
if(回零状态标志 & 0x20) { Ocp_TF = true; } else { Ocp_TF = false; }

// 判断回零的状态
int org_state = 回零状态标志 & 0x0C;
if(org_state == 0x04) { 正在回零 }
if(org_state == 0x08) { 回零失败 }
if(org_state == 0x00) { 回零成功 }
```

#### 5.4.5 读取回零参数

**主机发送（主机→电机）**

| 地址 | 功能码 | 校验码 |
| --- | --- | --- |
| Addr | 22 | 6B |

**电机返回（电机→主机）**

| 字节1 | 字节2 | 字节3 | 字节4 | 字节5 | 字节6-字节9 | 字节10 | 字节11-字节14 | 字节15 | 字节16 | 字节17 | 字节18 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 地址 | 功能码 | 回零模式 | 回零方向 | 回零速度 | 回零超时时间 | 碰撞回零检测转速 | 碰撞回零检测电流 | 碰撞回零检测时间 | O_POT_En | 校验码 |
| Addr | 22 | 00-05 | 00/01 | 0000-0BB8 | 00000000-FFFFFFFF | 0000-0BB8 | 0000-1388 | 0000-FFFF | 00/01 | 6B |

**说明：** 参数解析见下面的"5.4.6 修改回零参数"命令说明。

#### 5.4.6 修改回零参数

**主机发送（主机→电机）**

| 字节1 | 字节2 | 字节3 | 字节4 | 字节5 | 字节6 | 字节7 | 字节8 | 字节9 | 字节10 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 地址 | 功能码 | 辅助码 | 是否存储 | 回零模式 | 回零方向 | 回零速度 | 回零超时时间(Hi) |
| Addr | 4C | AE | 00/01 | 00-05 | 00/01 | 0000-0BB8 | 0000-FFFF |

| 字节11 | 字节12 | 字节13 | 字节14 | 字节15 | 字节16 | 字节17 | 字节18 | 字节19 | 字节20 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 回零超时时间(Lo) | 碰撞回零检测转速 | 碰撞回零检测电流 | 碰撞回零检测时间 | O_POT_En | 校验码 |
| 0000-FFFF | 0000-0BB8 | 0000-1388 | 0000-FFFF | 00/01 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | 4C | 02/E2/EE(参考第4章节说明) | 6B |

**参数说明：**
- 是否存储：00/01分别表示不存储/存储，存储后数据掉电不丢失
- 回零模式：默认值为00，即单圈就近回零模式
  - 00：单圈就近回零
  - 01：单圈方向回零
  - 02：无限位碰撞回零
  - 03：限位回零
  - 04：回到绝对位置坐标零点
  - 05：回到上次掉电位置角度
- 回零方向：00/01分别表示CW/CCW，默认为CW
- 回零速度：范围为0000-0BB8，即0-3000RPM，默认为30RPM
- 回零超时时间：超时将自动退出回零，单位为毫秒，默认为10000毫秒
- 碰撞回零检测转速/电流/时间：默认值分别为300RPM/800mA/60ms
  - 原理：将电机堵转位置作为零点，同时满足下列条件即完成碰撞检测：
    1. 电机实时转速 < 碰撞回零检测转速
    2. 电机实时相电流 > 碰撞回零检测电流
    3. 满足(1)和(2)持续的时间 > 碰撞回零检测时间
- O_POT_En：是否使能上电自动触发回零功能，00/01分别表示不使能/使能

**示例：** 例如，发送 `01 4C AE 01 00 00 00 1E 00 00 27 10 01 2C 03 20 00 3C 00 6B` 修改回零参数，正确返回 `01 4C 02 6B`。

**参数解析：**
- 01 = 保存本次修改的配置参数
- 00 = 回零模式为Nearest（单圈就近回零模式）
- 00 = 回零方向为CW
- 001E = 回零速度为30(RPM)
- 00002710 = 回零超时时间为10000(ms)
- 012C = 碰撞回零检测转速为300(RPM)
- 0320 = 碰撞回零检测电流为800(Ma)
- 003C = 碰撞回零检测时间为60(ms)
- 00 = 不使能上电自动触发回零功能

**读取示例：** 例如，发送 `01 22 6B` 读取回零参数，假设返回 `01 22 00 00 00 1E 00 00 27 10 01 2C 03 20 00 3C 00 6B`：
- 回零模式 = 00 = Nearest = 单圈就近回零模式
- 回零方向 = 00 = CW
- 回零转速 = 001E = 30(RPM)
- 回零超时时间 = 00002710 = 10000(ms)
- 碰撞回零检测转速 = 012C = 300(RPM)
- 碰撞回零检测电流 = 0320 = 800(Ma)
- 碰撞回零检测时间 = 003C = 60(ms)
- 上电自动回零使能 = 00 = 不使能

### 5.5 读取系统参数命令

#### 5.5.1 定时返回信息命令（X42S/Y42）

**主机发送（主机→电机）**

| 字节1 | 字节2 | 字节3 | 字节4 | 字节5 | 字节6 | 字节7 |
| --- | --- | --- | --- | --- | --- | --- |
| 地址 | 功能码 | 辅助码 | 信息功能码 | 定时时间(毫秒) | 校验码 |
| Addr | 11 | 18 | 36/3A/... | 0-FFFF | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | 数据返回格式见"信息功能码"中对应的命令小节 | 6B |

**说明：**
1. 使用定时返回信息命令，可以让电机定时连续返回信息，而不需要频繁读取
2. 定时返回信息命令支持的命令为"5.5 读取系统参数命令"中的命令功能码

**示例：**

**示例1：** 让电机1每隔1毫秒返回一次实时位置信息，发送定时返回信息命令为：`01 11 18 36 00 01 6B`，电机返回的格式见"读取电机实时位置"命令。
- 36 = "5.5.13 读取电机实时位置"命令的功能码为36
- 0001 = 定时时间为1毫秒

**示例2：** 让电机2每隔10毫秒返回一次电机状态标志，发送定时返回信息命令：`02 11 18 3A 00 0A 6B`，电机返回的格式见"读取电机状态标志"命令。
- 3A = "5.5.15 读取电机状态标志"命令的功能码为3A
- 000A = 定时时间为10毫秒

**示例3：** 让电机2停止返回电机状态标志，发送命令：`02 11 18 3A 00 00 6B`，电机将返回确认收到命令"02 11 6B"。
- 3A = "5.5.15 读取电机状态标志"命令的功能码为3A
- 0000 = 定时时间为0毫秒，即停止返回

#### 5.5.2 读取固件版本和硬件版本

**主机发送（主机→电机）**

| 地址 | 功能码 | 校验码 |
| --- | --- | --- |
| Addr | 1F | 6B |

**电机返回（电机→主机）**

| 字节1 | 字节2 | 字节3 | 字节4 | 字节5 | 字节6 | 字节7 |
| --- | --- | --- | --- | --- | --- | --- |
| 地址 | 功能码 | 固件版本 | 硬件版本 | 校验码 |
| Addr | 1F | FW_Ver | HW_Series | HW_Type | HW_Ver | 6B |

**参数说明：**
- FW_Ver：固件版本号，例如200表示固件版本为V2.0.0
- HW_Series：硬件板卡系列，0/1分别表示X系列板卡和Y系列板卡
- HW_Type：硬件板卡类型，0/1/2/3/4/5/6分别表示20/28/35/42/57/86
- HW_Ver：固件版本号，例如14表示硬件版本为V2.0

#### 5.5.3 读取相电阻和相电感

**主机发送（主机→电机）**

| 地址 | 功能码 | 校验码 |
| --- | --- | --- |
| Addr | 20 | 6B |

**电机返回（电机→主机）**

| 字节1 | 字节2 | 字节3 | 字节4 | 字节5 | 字节6 | 字节7 |
| --- | --- | --- | --- | --- | --- | --- |
| 地址 | 功能码 | 相电阻 | 相电感 | 校验码 |
| Addr | 20 | Pha_R | Pha_L | 6B |

**参数说明：**
- 相电阻：单位：mΩ
- 相电感：单位：uH

#### 5.5.4 读取总线电压

**主机发送（主机→电机）**

| 字节1 | 字节2 | 字节3 | 字节4 | 字节5 |
| --- | --- | --- | --- | --- |
| 地址 | 功能码 | 总线电压 | 校验码 |
| Addr | 24 | VBus | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 总线电压 | 校验码 |
| --- | --- | --- | --- |
| Addr | 24 | VBus | 6B |

**参数说明：**
- 总线电压VBus：单位：mV，即供电电压V+经过反接二极管后的电压值

#### 5.5.5 读取总线电流（X42S/Y42）

**主机发送（主机→电机）**

| 字节1 | 字节2 | 字节3 | 字节4 | 字节5 |
| --- | --- | --- | --- | --- |
| 地址 | 功能码 | 总线电流 | 校验码 |
| Addr | 26 | CBus | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 总线电流 | 校验码 |
| --- | --- | --- | --- |
| Addr | 26 | CBus | 6B |

**参数说明：**
- 总线电流CBus：单位：mA，即V+引脚供电的电流

**注意：** 总线电流为相电流和相电压换算得到，可能存在偏差，仅提供趋势参考。

#### 5.5.6 读取相电流

**主机发送（主机→电机）**

| 字节1 | 字节2 | 字节3 | 字节4 | 字节5 |
| --- | --- | --- | --- | --- |
| 地址 | 功能码 | 相电流 | 校验码 |
| Addr | 27 | CPha | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 相电流 | 校验码 |
| --- | --- | --- | --- |
| Addr | 27 | CPha | 6B |

**参数说明：**
- 相电流CPha：单位：mA，即电机实际工作电流

#### 5.5.7 读取经过线性化校准后的编码器值

**主机发送（主机→电机）**

| 字节1 | 字节2 | 字节3 | 字节4 | 字节5 |
| --- | --- | --- | --- | --- |
| 地址 | 功能码 | 线性化编码器值 | 校验码 |
| Addr | 31 | 0-65535 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 线性化编码器值 | 校验码 |
| --- | --- | --- | --- |
| Addr | 31 | 0-65535 | 6B |

**参数说明：**
- 线性化编码器值：范围为0-65535表示0-360度

**注意：** 线性化编码器为单圈绝对值，即从0到65535后，又会重新从0开始。

#### 5.5.8 读取输入脉冲数

**主机发送（主机→电机）**

| 字节1 | 字节2 | 字节3 | 字节4 | 字节5 | 字节6 | 字节7 | 字节8 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 地址 | 功能码 | 符号 | 输入脉冲数 | 校验码 |
| Addr | 32 | 00/01 | 00000000-FFFFFFFF | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 符号 | 输入脉冲数 | 校验码 |
| --- | --- | --- | --- | --- |
| Addr | 32 | 00/01 | 00000000-FFFFFFFF | 6B |

**参数说明：**
- 符号：00/01分别表示输入脉冲数的正/负号
- 输入脉冲数：输入脉冲数个数，默认16细分下，3200个脉冲表示一圈360度

#### 5.5.9 读取电机目标位置

**主机发送（主机→电机）**

| 字节1 | 字节2 | 字节3 | 字节4 | 字节5 | 字节6 | 字节7 | 字节8 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 地址 | 功能码 | 符号 | 电机目标位置 | 校验码 |
| Addr | 33 | 00/01 | 00000000-FFFFFFFF | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 符号 | 电机目标位置 | 校验码 |
| --- | --- | --- | --- | --- |
| Addr | 33 | 00/01 | 00000000-FFFFFFFF | 6B |

**参数说明：**
- 符号：00/01分别表示目标位置的正/负号
- 电机目标位置：两种固件返回的含义不同，其含义及转换为角度单位如下
  - Emm固件：0-65535表示一圈0-360°，角度值=(目标位置 * 360)/65536
  - X固件：角度值 = 目标位置/10，比如返回的目标位置为16，则为1.6°

#### 5.5.10 读取电机实时设定的目标位置

**主机发送（主机→电机）**

| 字节1 | 字节2 | 字节3 | 字节4 | 字节5 | 字节6 | 字节7 | 字节8 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 地址 | 功能码 | 符号 | 设定目标位置 | 校验码 |
| Addr | 34 | 00/01 | 00000000-FFFFFFFF | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 符号 | 设定目标位置 | 校验码 |
| --- | --- | --- | --- | --- |
| Addr | 34 | 00/01 | 00000000-FFFFFFFF | 6B |

**参数说明：**
- 符号：00/01分别表示开环模式实时位置的正/负号
- 设定目标位置：两种固件返回的含义不同，其含义及转换为角度单位如下
  - Emm固件：0-65535表示一圈0-360°，角度值=(目标位置 * 360)/65536
  - X固件：角度值 = 目标位置/10，比如返回的目标位置为16，则为1.6°

#### 5.5.11 读取电机实时转速

**主机发送（主机→电机）**

| 字节1 | 字节2 | 字节3 | 字节4 | 字节5 | 字节6 |
| --- | --- | --- | --- | --- | --- |
| 地址 | 功能码 | 符号 | 电机实时转速 | 校验码 |
| Addr | 35 | 00/01 | 0000-1388 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 符号 | 电机实时转速 | 校验码 |
| --- | --- | --- | --- | --- |
| Addr | 35 | 00/01 | 0000-1388 | 6B |

**参数说明：**
- 符号：00/01分别表示电机实时转速的正/负号
- 电机实时转速：Emm固件单位为RPM，X固件单位为0.1RPM，所以返回值需要/10

#### 5.5.12 读取驱动温度（X42S/Y42）

**主机发送（主机→电机）**

| 字节1 | 字节2 | 字节3 | 字节4 | 字节5 |
| --- | --- | --- | --- | --- |
| 地址 | 功能码 | 温度符号 | 温度 | 校验码 |
| Addr | 39 | 00/01 | Temp | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 温度符号 | 温度 | 校验码 |
| --- | --- | --- | --- | --- |
| Addr | 39 | 00/01 | Temp | 6B |

**参数说明：**
- 温度符号：00/01分别表示负数/正数
- 温度Temp：驱动实时温度，单位℃

#### 5.5.13 读取电机实时位置

**主机发送（主机→电机）**

| 字节1 | 字节2 | 字节3 | 字节4 | 字节5 | 字节6 | 字节7 | 字节8 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 地址 | 功能码 | 符号 | 电机实时位置 | 校验码 |
| Addr | 36 | 00/01 | 00000000-FFFFFFFF | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 符号 | 电机实时位置 | 校验码 |
| --- | --- | --- | --- | --- |
| Addr | 36 | 00/01 | 00000000-FFFFFFFF | 6B |

**参数说明：**
- 符号：00/01分别表示电机实时位置的正/负号
- 电机实时位置：两种固件返回的含义不同，其含义及转换为角度单位如下
  - Emm固件：0-65535表示一圈0-360°，角度值=(实时位置 * 360)/65536
  - X固件：角度值 = 实时位置/10，比如返回的实时位置为16，则为1.6°

#### 5.5.14 读取电机位置误差

**主机发送（主机→电机）**

| 字节1 | 字节2 | 字节3 | 字节4 | 字节5 | 字节6 | 字节7 | 字节8 |
| --- | --- | --- | --- | --- | --- | --- |
| 地址 | 功能码 | 符号 | 电机位置误差 | 校验码 |
| Addr | 37 | 00/01 | 00000000-FFFFFFFF | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 符号 | 电机位置误差 | 校验码 |
| --- | --- | --- | --- | --- |
| Addr | 37 | 00/01 | 00000000-FFFFFFFF | 6B |

**参数说明：**
- 符号：00/01分别表示电机位置误差的正/负号
- 电机位置误差：两种固件返回的含义不同，其含义及转换为角度单位如下
  - Emm固件：0-65535表示一圈0-360°，角度值=(位置误差 * 360)/65536
  - X固件：角度值 = 位置误差/100，比如返回的位置误差为8，则为0.08°

#### 5.5.15 读取电机状态标志

**主机发送（主机→电机）**

| 地址 | 功能码 | 校验码 |
| --- | --- | --- |
| Addr | 3A | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | bit7 | bit6 | bit5 | bit4 | bit3 | bit2 | bit1 | bit0 | 校验码 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Addr | 3A | Oac_TF | 保留 | Esi_RF | Esi_LF | Cgp_TF | Cgi_TF | Prf_TF | Ens_TF | 6B |

**参数说明：**
- Oac_TF：掉电标志，默认为1，可通过命令写入0，写入后发生过掉电将恢复1
- Esi_RF：右限位开关的状态，0/1分别表示右限位输入引脚为低/高电平状态
- Esi_LF：左限位开关的状态，0/1分别表示左限位输入引脚为低/高电平状态
- Cgp_TF/Cgi_TF：堵转保护标志/堵转标志，0/1分别表示未触发/已触发
  - 满足下列条件即触发堵转保护：
    1. 电机实时转速 < 电机堵转检测转速
    2. 电机实时相电流 > 电机堵转检测电流
    3. 满足(1)和(2)持续的时间 > 电机堵转检测时间
  - 满足(1)(2)置位堵转标志，满足(1)(2)(3)触发堵转保护
- Prf_TF：位置到达标志，0/1分别表示电机运动未到达/已到达输入目标位置
- Ens_TF：使能状态标志，0/1分别表示未使能/已使能电机

**示例：** 例如，发送 `01 3A 6B` 读取电机状态标志，假设返回 `01 3A 83 6B`，其中83为电机状态标志，83二进制数为10000011，即Oac_TF、Prf_TF和Ens_TF为1，其余为0。

**编程判断：**
```c
if(电机状态标志 & 0x01) { Ens_TF = true; } else { Ens_TF = false; }
if(电机状态标志 & 0x02) { Prf_TF = true; } else { Prf_TF = false; }
if(电机状态标志 & 0x04) { Cgi_TF = true; } else { Cgi_TF = false; }
if(电机状态标志 & 0x08) { Cgp_TF = true; } else { Cgp_TF = false; }
if(电机状态标志 & 0x10) { Esi_LF = true; } else { Esi_LF = false; }
if(电机状态标志 & 0x20) { Esi_RF = true; } else { Esi_RF = false; }
if(电机状态标志 & 0x80) { Oac_TF = true; } else { Oac_TF = false; }
```

#### 5.5.16 读取回零状态标志 + 电机状态标志（X42S/Y42）

**主机发送（主机→电机）**

| 地址 | 功能码 | 校验码 |
| --- | --- | --- |
| Addr | 3C | 6B |

**电机返回（电机→主机）**

| 字节1 | 字节2 | 字节3 | 字节4 | 字节5 |
| --- | --- | --- | --- | --- |
| 地址 | 功能码 | 回零状态标志 | 电机状态标志 | 校验码 |
| Addr | 3C | 参考 5.4.4 小节 | 参考 5.5.15 小节 | 6B |

**参数说明：**
- 回零状态标志见"5.4.4 读取回零状态标志"小节的参数说明
- 电机状态标志见"5.5.15 读取电机状态标志"小节的参数说明

#### 5.5.17 读取引脚 IO 电平状态（X42S/Y42）

**主机发送（主机→电机）**

| 地址 | 功能码 | 校验码 |
| --- | --- | --- |
| Addr | 3D | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | bit7 | bit6 | bit5 | bit4 | bit3 | bit2 | bit1 | bit0 | 校验码 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Addr | 3D | 保留 | 保留 | Dir_OM | Dir_Pin | 0 | Stp_Pin | 0 | En_Pin | 6B |

**参数说明：**
- bit0：使能引脚电平状态En_Pin，0为低电平，1为高电平
- bit1、bit3：保持为0
- bit2：脉冲引脚电平状态Stp_Pin，0为低电平，1为高电平
- bit4：方向引脚电平状态Dir_Pin，0为低电平，1为高电平
- bit5：方向引脚输出模式Dir_OM，0为输入模式，1为输出模式
- bit6、bit7：保留

#### 5.5.18 读取电池电压（Y42）

**主机发送（主机→电机）**

| 字节1 | 字节2 | 字节3 | 字节4 | 字节5 |
| --- | --- | --- | --- | --- |
| 地址 | 功能码 | 电池电压 | 校验码 |
| Addr | 38 | VBat | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 电池电压 | 校验码 |
| --- | --- | --- | --- |
| Addr | 38 | VBat | 6B |

**参数说明：**
- 电池电压VBat：单位：mV，即低功耗掉电记录接入电池的电压值

### 5.6 读写驱动参数命令

#### 5.6.1 修改电机 ID/地址

**主机发送（主机→电机）**

| 地址 | 功能码 | 辅助码 | 是否存储 | ID/地址 | 校验码 |
| --- | --- | --- | --- | --- | --- |
| Addr | AE | 02/E2/EE | 00/01 | 00-FF | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | AE | 02/E2/EE(参考第 4 章节说明) | 6B |

**参数说明：**
- 是否存储：00/01分别表示不存储/存储，存储后数据掉电不丢失
- ID/地址：默认值为 1，可修改范围为 01-FF(1-255)，00 为广播地址

#### 5.6.2 修改细分值

**主机发送（主机→电机）**

| 地址 | 功能码 | 辅助码 | 是否存储 | 细分值 | 校验码 |
| --- | --- | --- | --- | --- | --- |
| Addr | 84 | 8A | 00/01 | 00-FF | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | 84 | 02/E2/EE(参考第 4 章节说明) | 6B |

**参数说明：**
- 是否存储：00/01分别表示不存储/存储，存储后掉电不丢失参数
- 细分值：默认值为 16，01-FF 分别表示 1-255 细分，00 表示 256 细分
- 注意：1.8°电机，默认 16 细分下，Emm 固件发送 3200 个脉冲电机转一圈 0-360°

#### 5.6.3 修改掉电标志

**主机发送（主机→电机）**

| 地址 | 功能码 | 掉电标志 | 校验码 |
| --- | --- | --- | --- |
| Addr | 50 | 00/01 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | 50 | 02/E2/EE(参考第 4 章节说明) | 6B |

**参数说明：**
- 掉电标志：默认为 1，可修改为 0，掉电重新上电后恢复为 1，可知发生过掉电

#### 5.6.4 读取选项参数状态（X42S/Y42）

**主机发送（主机→电机）**

| 地址 | 功能码 | 校验码 |
| --- | --- | --- |
| Addr | 1A | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | bit7 | bit6 | bit5 | bit4 | bit3 | bit2 | bit1 | bit0 | 校验码 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Addr | 1A | Scale | 保留 | BtLock | MotDir | 保留 | CtrMode | FwType | MotType | 6B |

**参数说明：**
- bit0：电机类型，0 表示当前为 1.8°步进电机，1 表示 0.9 度步进电机
- bit1：固件类型，0 表示当前为 X 固件，1 表示 Emm 固件
- bit2：控制模式，0 表示当前为开环模式，1 表示闭环模式
- bit4：电机运动正方向，0 表示当前为 CW(顺时针方向)，1 表示 CCW(逆时针)
- bit5：锁定按键功能，0 表示当前为按键没上锁状态，1 表示按键被锁定状态
- bit7：是否缩小 10 倍输入功能，0 表示当前为失能，1 表示使能
- bit8-bit9：锁定修改参数等级，见"5.6.31 修改锁定修改参数功能（X42S/Y42）"

#### 5.6.5 修改电机类型

**主机发送（主机→电机）**

| 地址 | 功能码 | 辅助码 | 是否存储 | 电机类型 | 校验码 |
| --- | --- | --- | --- | --- | --- |
| Addr | D7 | 35 | 00/01 | 19/32 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | D7 | 02/E2/EE(参考第 4 章节说明) | 6B |

**参数说明：**
- 是否存储：00/01 分别表示不存储/存储，存储后掉电不丢失参数
- 电机类型：默认值为 50，25/50 分别表示 0.9°/1.8°步进电机
- 注意：根据自身使用的电机类型进行修改，修改后要重新空载校准电机

#### 5.6.6 修改固件类型

**主机发送（主机→电机）**

| 地址 | 功能码 | 辅助码 | 是否存储 | 固件类型 | 校验码 |
| --- | --- | --- | --- | --- | --- |
| Addr | D5 | 69 | 00/01 | 00/01/02 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | D5 | 02/E2/EE(参考第 4 章节说明) | 6B |

**参数说明：**
- 是否存储：00/01 分别表示不存储/存储，存储后掉电不丢失参数
- 固件类型：默认值为 01，00/01/02 分别表示 X 固件/Emm 固件/Emm 固件狂暴模式
- 注意：修改固件类型，尽可能保持电机在停止状态下进行修改

#### 5.6.7 修改开环/闭环控制模式

**主机发送（主机→电机）**

| 地址 | 功能码 | 辅助码 | 是否存储 | 控制模式 | 校验码 |
| --- | --- | --- | --- | --- | --- |
| Addr | 46 | A6 | 00/01 | 00/01 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | 46 | 02/E2/EE(参考第 4 章节说明) | 6B |

**参数说明：**
- 是否存储：00/01 分别表示不存储/存储，存储后掉电不丢失参数
- 控制模式：默认值为 01，00/01 分别表示开环/闭环控制模式
- 注意：修改控制模式，尽可能保持电机在停止状态下进行修改

#### 5.6.8 修改电机运动正方向

**主机发送（主机→电机）**

| 地址 | 功能码 | 辅助码 | 是否存储 | 电机运动正方向 | 校验码 |
| --- | --- | --- | --- | --- | --- |
| Addr | D4 | 60 | 00/01 | 00/01 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | D4 | 02/E2/EE(参考第 4 章节说明) | 6B |

**参数说明：**
- 是否存储：00/01 分别表示不存储/存储，存储后掉电不丢失参数
- 电机运动正方向：默认值为 00，00/01 分别表示 CW/CCW（顺时针/逆时针）
- 说明：修改的是电机运动的正方向，电机运动的正方向也跟电机线序有关，将**A+A-或 B+B-**任一组线序对调，然后空载重新校准电机，也可以改变正方向

#### 5.6.9 修改锁定按键功能

**主机发送（主机→电机）**

| 地址 | 功能码 | 辅助码 | 是否存储 | 锁定按键功能 | 校验码 |
| --- | --- | --- | --- | --- | --- |
| Addr | D0 | B3 | 00/01 | 00/01 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | D0 | 02/E2/EE(参考第 4 章节说明) | 6B |

**参数说明：**
- 是否存储：00/01 分别表示不存储/存储，存储后掉电不丢失参数
- 锁定按键功能：默认值为 00，00/01 分别表示解锁/锁定按键
- 注意：锁定按键后，除恢复出厂设置功能外，其他按键功能不起作用，需要再次发送解锁按键命令，按键功能才能重新生效，防止误触发按键

#### 5.6.10 修改命令位置角度是否继续缩小 10 倍输入（X）

**主机发送（主机→电机）**

| 地址 | 功能码 | 辅助码 | 是否存储 | 是否继续缩小 | 校验码 |
| --- | --- | --- | --- | --- | --- |
| Addr | 4F | 71 | 00/01 | 00/01 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | 4F | 02/E2/EE(参考第 4 章节说明) | 6B |

**参数说明：**
- 是否存储：00/01 分别表示不存储/存储，存储后掉电不丢失参数
- 是否继续缩小：默认值为 00，00/01 分别表示命令位置角度值关闭/使能继续缩小 10 倍输入，X 固件默认最小输入角度值为 0.1°，使能后，将精确到 0.01°输入，比如，发送 1 的位置角度值，电机实际运行 0.01°，以此类推

#### 5.6.11 修改命令速度值是否缩小 10 倍输入（Emm）

**主机发送（主机→电机）**

| 地址 | 功能码 | 辅助码 | 是否存储 | 是否缩小 | 校验码 |
| --- | --- | --- | --- | --- | --- |
| Addr | 4F | 71 | 00/01 | 00/01 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | 4F | 02/E2/EE(参考第 4 章节说明) | 6B |

**参数说明：**
- 是否存储：00/01 分别表示不存储/存储，存储后掉电不丢失参数
- 是否缩小：默认值为 00，00/01 分别表示通讯控制命令速度值关闭/使能速度值缩小 10 倍输入，Emm 固件默认最小输入速度值为 1RPM，使能后，将精确到 0.1RPM输入，比如，发送 1RPM 速度值，电机实际以 0.1RPM 的速度运行

#### 5.6.12 修改开环模式工作电流

**主机发送（主机→电机）**

| 地址 | 功能码 | 辅助码 | 是否存储 | 开环模式工作电流 | 校验码 |
| --- | --- | --- | --- | --- | --- |
| Addr | 44 | 33 | 00/01 | 0000-1388 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | 44 | 02/E2/EE(参考第 4 章节说明) | 6B |

**参数说明：**
- 是否存储：00/01 分别表示不存储/存储，存储后掉电不丢失参数
- 开环模式工作电流：默认值为 X42S/1200mA，范围 0000-1388，即 0-5000mA
- 注意：开环模式工作电流不要设置太大，太大电机发热会很严重

#### 5.6.13 修改闭环模式最大电流

**主机发送（主机→电机）**

| 地址 | 功能码 | 辅助码 | 是否存储 | 闭环模式最大电流 | 校验码 |
| --- | --- | --- | --- | --- | --- |
| Addr | 45 | 66 | 00/01 | 0000-1388 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | 45 | 02/E2/EE(参考第 4 章节说明) | 6B |

**参数说明：**
- 是否存储：00/01 分别表示不存储/存储，存储后掉电不丢失参数
- 闭环模式最大电流：默认值为 X42S/3000mA，范围 0000-1388，即 0-5000mA
- Emm 固件：表示堵转最大电流，堵转时达到的电流值不超过此值
- X 固件：表示电机正常运行过程中，不管什么状态都不会超过此值

#### 5.6.14 读取 PID 参数（X）

**主机发送（主机→电机）**

| 地址 | 功能码 | 校验码 |
| --- | --- | --- |
| Addr | 21 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 梯形曲线位置环 Kp | 直通限速位置环 Kp | 速度环 Kp | 速度环 Ki | 校验码 |
| --- | --- | --- | --- | --- | --- | --- |
| Addr | 21 | pTkp | pBkp | vkp | vki | 6B |

**参数说明：**
- 参数解析见下面的"5.6.15 修改 PID 参数（X）"命令说明

#### 5.6.15 修改 PID 参数（X）

**主机发送（主机→电机）**

| 地址 | 功能码 | 辅助码 | 是否存储 | 梯形曲线位置环 Kp | 直通限速位置环 Kp | 速度环 Kp | 速度环 Ki | 校验码 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Addr | 4A | C3 | 00/01 | pTkp | pBkp | vkp | vki | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | 4A | 02/E2/EE(参考第 4 章节说明) | 6B |

**参数说明：**
- 梯形曲线位置环 kp/直通限速位置环 kp：默认值为(X42S/X57S)/126640
- 速度环 kp：默认值为(X28S/X35S)/12600，X42S/15600，X57S/26000
- 速度环 ki：默认值为(X28S/X35S)/18，X42S/26，X57S/58
- 例如，修改 PID 参数发送 `01 4A C3 01 00 01 EE B0 00 01 EE B0 00 00 3C F0 00 00 00 1A 6B`，正确返回 `01 4A 02 6B`
  - `01` = 保存本次修改的配置参数
  - `0001EEB0` = 梯形曲线位置环 kp 为 126640
  - `0001EEB0` = 直通限速位置环 kp 为 126640
  - `00003CF0` = 速度环 kp 为 15600
  - `0000001A` = 速度环 ki 为 26

#### 5.6.16 读取 PID 参数（Emm）

**主机发送（主机→电机）**

| 地址 | 功能码 | 校验码 |
| --- | --- | --- |
| Addr | 21 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 比例系数 | 积分系数 | 微分系数 | 校验码 |
| --- | --- | --- | --- | --- | --- |
| Addr | 21 | Kp | Ki | Kd | 6B |

**参数说明：**
- 参数解析见下面的"5.6.17 修改 PID 参数（Emm）"命令说明

#### 5.6.17 修改 PID 参数（Emm）

**主机发送（主机→电机）**

| 地址 | 功能码 | 辅助码 | 是否存储 | 比例系数 | 积分系数 | 微分系数 | 校验码 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| Addr | 4A | C3 | 00/01 | Kp | Ki | Kd | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | 4A | 02/E2/EE(参考第 4 章节说明) | 6B |

**参数说明：**
- 比例系数 Kp：默认值为(X28S/X35S/X42S)/18000，Y57/32000
- 积分系数 Ki：默认值为 10
- 微分系数 Kd：默认值为(X28S/X35S/X42S)/18000，X57S/32000
- 例如修改 PID 参数发送 `01 4A C3 01 00 00 46 50 00 00 00 0A 00 00 46 50 6B`
  - `01` = 保存本次修改的配置参数
  - `00004650` = 比例系数 Kp 为 18000
  - `0000000A` = 积分系数 Ki 为 10
  - `00004650` = 微分系数 Kd 为 18000

#### 5.6.18 读取 DMX512 协议参数（X42S/Y42）

**主机发送（主机→电机）**

| 地址 | 功能码 | 辅助码 | 校验码 |
| --- | --- | --- | --- |
| Addr | 49 | 78 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 总通道数 | 每个电机占用的通道数 | 运动模式 | 单通道模式的运动速度 | 加速度 | 双通道模式速度步长 | 双通道模式运动步长 | 校验码 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Addr | 49 | 0001-0040 | 01/02 | 00/01 | 0001-0BB8 | 0001-FFFF | 0001-FFFF | 00000001-FFFFFFFF | 6B |

**参数说明：**
- 参数解析见下面的"5.6.19 修改 DMX512 协议参数（X42S/Y42）"命令说明

#### 5.6.19 修改 DMX512 协议参数（X42S/Y42）

**主机发送（主机→电机）**

| 地址 | 功能码 | 辅助码 | 是否存储 | 总通道数 | 每个电机占用的通道数 | 运动模式 | 单通道模式的运动速度 | 加速度 | 双通道模式速度步长 | 双通道模式运动步长 | 校验码 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Addr | D9 | 90 | 00/01 | 0001-0040 | 01/02 | 00/01 | 0001-0BB8 | 0001-FFFF | 0001-FFFF | 00000001-FFFFFFFF | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | D9 | 02/E2/EE(参考第 4 章节说明) | 6B |

**参数说明：**
- 总通道数：控制台的总通道数，默认值为 192，适配市面上的 DMX512 控制台(一般为 192 个通道)，该值要与自身 DMX512 控制器的总通道数一样
- 每个电机占用的通道数：
  - (1) 默认值为 1，即单通道模式，一个电机占用 1 个通道，即每个通道控制对应地址电机的位置角度，如通道 1 控制地址为 1 电机的位置角度
  - (2) 设置为 2 时，为双通道模式，则低通道表示位置，高通道表示速度，如通道 1 和 2 分别控制地址 1 电机的位置角度和速度，如此类推
- 运动模式：
  - (1) 默认值为 1，表示绝对坐标式位置运动（相对上电时零点进行绝对运动）
  - (2) 当设置为 0，表示相对位置模式运动（相对当前位置进行增量运动）
- 单通道模式的运动速度：默认值为 1000，单位 RPM，即 1000RPM
- 加速度：默认值为 1000，值越大，加速越快，两种固件的加速度计算如下：
  - Emm 固件：acc=加速数值/8=125，加速时间见"5.3.12 位置模式控制（Emm）"
  - X 固件：单位为 RPM，即加速度为 1000RPM/s
- 双通道模式速度步长：默认值为 10，即电机运动速度为(通道值 * 10)RPM
- 双通道模式运动步长：默认值为 100，即电机转动角度为(通道值 * 10.0)°
- 例如，修改 DMX512 协议参数发送 `01 D9 90 01 00 C0 01 01 03 E8 03 E8 00 0A 00 00 00 64 6B`，正确返回 `01 D9 02 6B`
  - `01` = 保存本次修改的配置参数
  - `00C0` = 总通道数为 192 个通道
  - `01` = 每个电机占用的通道数为 1，即单通道模式
  - `01` = 运动模式为绝对坐标式位置运动
  - `03E8` = 单通道模式的运动速度为 1000RPM
  - `03E8` = 加速值为 1000，Emm 固件加速度 acc 为 125，X 固件为 1000RPM/s
  - `000A` = 双通道模式速度步长为 10RPM
  - `00000064` = 双通道模式运动步长值为 100，缩小 10 倍处理，即 10.0°

#### 5.6.20 读取位置到达窗口（X42S/Y42）

**主机发送（主机→电机）**

| 地址 | 功能码 | 校验码 |
| --- | --- | --- |
| Addr | 41 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 位置到达窗口 | 校验码 |
| --- | --- | --- | --- |
| Addr | 41 | Pos_Window | 6B |

**参数说明：**
- 参数解析见下面的"5.6.21 修改位置到达窗口（X42S/Y42）"命令说明

#### 5.6.21 修改位置到达窗口（X42S/Y42）

**主机发送（主机→电机）**

| 地址 | 功能码 | 辅助码 | 是否存储 | 位置到达窗口 | 校验码 |
| --- | --- | --- | --- | --- | --- |
| Addr | D1 | 07 | 00/01 | 0000-FFFF | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | D1 | 02/E2/EE(参考第 4 章节说明) | 6B |

**参数说明：**
- 位置到达窗口：默认值为 8，缩小 10 倍处理，即位置到达窗口默认值为 0.8°
- 当 `位置误差 = 目标位置 - 实时位置 < 位置到达窗口(0.8°)`，认为电机已经到达设定的位置，将置位 Prf_TF（位置到达标志位），如果"控制命令应答"参数设置为 Reached/Both/Other，则到位后返回：`地址 + 功能码 + 9F + 6B`
- 例如，修改位置到达窗口发送 `01 D1 07 01 00 08 6B`，正确返回 `01 D1 02 6B`
  - `01` = 保存本次修改的配置参数
  - `0008` = 位置到达窗口值修改为 0.8°（内部缩小了 10 倍处理）

#### 5.6.22 读取过热过流保护检测阈值（X42S/Y42）

**主机发送（主机→电机）**

| 地址 | 功能码 | 校验码 |
| --- | --- | --- |
| Addr | 13 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 过热保护检测阈值 | 过流保护检测阈值 | 过热过流检测时间 | 校验码 |
| --- | --- | --- | --- | --- | --- |
| Addr | 13 | 0000-FFFF | 0000-FFFF | 0000-FFFF | 6B |

**参数说明：**
- 参数解析见下面"5.6.23 修改过热过流保护检测阈值（X42S/Y42）"命令说明

#### 5.6.23 修改过热过流保护检测阈值（X42S/Y42）

**主机发送（主机→电机）**

| 地址 | 功能码 | 辅助码 | 是否存储 | 过热保护检测阈值 | 过流保护检测阈值 | 过热过流检测时间 | 校验码 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| Addr | D3 | 56 | 00/01 | 0000-FFFF | 0000-FFFF | 0000-FFFF | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | D3 | 02/E2/EE(参考第 4 章节说明) | 6B |

**参数说明：**
- 过热保护检测阈值：默认值为 100℃
- 过流保护检测阈值：默认值为 6600mA
- 过热过流检测阈值：默认值为 1000ms
- (1) 驱动实时温度/电流 >= 过热/过流保护检测阈值，持续的时间 >= 过热过流检测时间，将触发过热/过流保护
- 例如，修改过热过流保护检测阈值发送 `01 D3 56 01 00 64 19 C8 03 E8 6B`
  - `01` = 保存本次修改的配置参数
  - `0064` = 过热保护检测阈值修改为 100℃
  - `19C8` = 过流保护检测阈值修改为 6600mA
  - `03E8` = 过热过流检测时间改为 1000ms

#### 5.6.24 读取心跳保护功能时间（X42S/Y42）

**主机发送（主机→电机）**

| 地址 | 功能码 | 校验码 |
| --- | --- | --- |
| Addr | 16 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 心跳保护时间 | 校验码 |
| --- | --- | --- | --- |
| Addr | 16 | 00000000-FFFFFFFF | 6B |

**参数说明：**
- 参数解析见下面的"5.6.25 修改心跳保护功能时间（X42S/Y42）"命令说明

#### 5.6.25 修改心跳保护功能时间（X42S/Y42）

**主机发送（主机→电机）**

| 地址 | 功能码 | 辅助码 | 是否存储 | 心跳保护时间 | 校验码 |
| --- | --- | --- | --- | --- | --- |
| Addr | 68 | 38 | 00/01 | 00000000-FFFFFFFF | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | 68 | 02/E2/EE(参考第 4 章节说明) | 6B |

**参数说明：**
- 是否存储：00/01 分别表示不存储/存储，存储后掉电不丢失参数
- 心跳保护时间：默认值为 0，单位：ms
- 在设定时间内，电机如果没有接收到正确命令，则会控制电机急停下来，可以预防实时控制场景因通讯异常导致事故

#### 5.6.26 读取积分限幅/刚性系数（X42S/Y42）

**主机发送（主机→电机）**

| 地址 | 功能码 | 校验码 |
| --- | --- | --- |
| Addr | 23 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 积分限幅/刚性系数 | 校验码 |
| --- | --- | --- | --- |
| Addr | 23 | 00000000-FFFFFFFF | 6B |

**参数说明：**
- 参数解析见下面的" 5.6.27 修改积分限幅/刚性系数（X）"命令说明

#### 5.6.27 修改积分限幅/刚性系数（X42S/Y42）

**主机发送（主机→电机）**

| 地址 | 功能码 | 辅助码 | 是否存储 | 积分限幅/刚性系数 | 校验码 |
| --- | --- | --- | --- | --- | --- |
| Addr | 4B | 57 | 00/01 | 00000000-FFFFFFFF | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | 4B | 02/E2/EE(参考第 4 章节说明) | 6B |

**参数说明：**
- 是否存储：00/01 分别表示不存储/存储，存储后掉电不丢失参数
- 积分限幅/刚性系数：Emm 固件积分限幅默认为 65535/X 固件刚性系数默认为 X42S/388、X57S/512，值越大，静态力矩/刚性会更大一些，但太大电机会震颤

#### 5.6.28 读取碰撞回零返回角度（X42S/Y42）

**主机发送（主机→电机）**

| 地址 | 功能码 | 校验码 |
| --- | --- | --- |
| Addr | 3F | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 碰撞回零返回角度 | 校验码 |
| --- | --- | --- | --- |
| Addr | 3F | O_SL_RP | 6B |

**参数说明：**
- 参数解析见下面的"5.6.29 修改碰撞回零返回角度（X42S/Y42）"命令说明

#### 5.6.29 修改碰撞回零返回角度（X42S/Y42）

**主机发送（主机→电机）**

| 地址 | 功能码 | 辅助码 | 是否存储 | 碰撞回零返回角度 | 校验码 |
| --- | --- | --- | --- | --- | --- |
| Addr | 5C | AC | 00/01 | 0000-FFFF | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | 5C | 02/E2/EE(参考第 4 章节说明) | 6B |

**参数说明：**
- 碰撞回零返回角度：默认值为 0。因为碰撞瞬间电流较大，所以碰撞完成后需要返回一定角度位置，防止电机堵转。值为 0 是基于电流检测返回，即返回到(电机实际电流 < 碰撞回零检测电流)的位置，其余为固定值，比如，设置为 20，即 2.0°(放大 10 倍输入，单位为 0.1°)，即碰撞完成后固定返回 2.0 度。比如，设置为 100，即 10.0°，则碰撞完成后固定返回 2.0 度

#### 5.6.30 广播读取 ID 地址（X42S/Y42）

**主机发送（主机→电机）**

| 地址 | 功能码 | 校验码 |
| --- | --- | --- |
| 00 | 15 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 电机地址 | 校验码 |
| --- | --- | --- | --- |
| Addr | 15 | Addr | 6B |

**参数说明：**
- 当忘记电机 ID 地址时，可以单独接线该电机，广播读取该电机的地址

#### 5.6.31 修改锁定修改参数功能（X42S/Y42）

**主机发送（主机→电机）**

| 地址 | 功能码 | 辅助码 | 是否存储 | 锁定参数等级 | 校验码 |
| --- | --- | --- | --- | --- | --- |
| Addr | D6 | 4B | 00/01 | 00-03 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | D6 | 02/E2/EE(参考第 4 章节说明) | 6B |

**参数说明：**
- 是否存储：00/01 分别表示不存储/存储，存储后掉电不丢失参数
- 锁定参数等级：默认值为 00，00-03 分别表示不同的锁定参数等级
  - 00：解锁，解锁后可修改任意参数
  - 01：禁止修改(ID 地址 + 通讯速率 + 通讯协议 + 通讯端口复用)
  - 02/03：禁止(修改所有参数 + 触发校准)
- （注：读取锁定参数等级见"5.5.4 读取选项参数状态"）

## 5.7 上电自动运行命令

#### 5.7.1 存储一组速度参数，上电自动运行（X）

**主机发送（主机→电机）**

| 地址 | 功能码 | 辅助码 | 清除/存储 | 方向 | 加速度 | 速度 | 是否使能 En 引脚控制启停 | 校验码 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Addr | F7 | 1C | 00/01 | 00/01 | 0000-FFFF | 0000-7530 | 00/01 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | F7 | 02/E2/EE(参考第 4 章节说明) | 6B |

**参数说明：**
- 清除/存储：00 和 01 分别表示清除已存储速度和加速度/存储当前速度和加速度
- 方向：00/01 分别表示 CW/CCW
- 加速度：范围为 0000-FFFF，即 0-65535RPM/S（转每分钟每秒）
- 速度：范围为 0000-7E30，即 0-30000，保留一位小数，即 0-3000.0RPM
- 是否使能 En 引脚控制启停：00/01 分别表示不使能/使能 En 引脚控制启停
- 说明：使能后，可以利用给 En 引脚输入高低电平来控制电机的启动和停止，但需要设置 En 引脚有效电平状态，默认为 Hold，可以改为 L(低电平使能)或 H
- 例如，发送 `01 F7 1C 01 00 01 FF 17 70 01 6B`，正确返回 `01 F7 02 6B`
  - `01` = 保存本次修改的配置参数
  - `00` = 电机运动方向为 CW
  - `01FF` = 加速度为 511RPM/s
  - `1770` = 速度为 600.0RPM（内部自动缩小了 10 倍处理）
  - `01` = 使能 En 引脚控制启停

#### 5.7.2 存储一组速度参数，上电自动运行（Emm）

**主机发送（主机→电机）**

| 地址 | 功能码 | 辅助码 | 清除/存储 | 方向 | 速度 | 加速度 | 是否使能 En 引脚控制启停 | 校验码 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Addr | F7 | 1C | 00/01 | 00/01 | 0000-0BB8 | 00-FF | 00/01 | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 返回数据 | 校验码 |
| --- | --- | --- | --- |
| Addr | F7 | 02/E2/EE(参考第 4 章节说明) | 6B |

**参数说明：**
- 清除/存储：00 和 01 分别表示清除已存储速度和加速度/存储当前速度和加速度
- 方向：00/01 分别表示 CW/CCW
- 速度：范围为 0000-0BB8，即 0-3000RPM
- 加速度：范围为 0-255 档位，加速度计算公式见"5.3.7 速度模式控制（Emm）"
- 是否使能 En 引脚控制启停：00/01 分别表示不使能/使能 En 引脚控制启停
- 说明：使能后，可以利用给 En 引脚输入高低电平来控制电机的启动和停止，但需要设置 En 引脚有效电平状态，默认为 Hold，可以改为 L(低电平使能)或 H
- 例如，发送 `01 F7 1C 01 00 02 58 64 01 6B`，正确返回 `01 F7 02 6B`
  - `01` = 保存本次修改的配置参数
  - `00` = 电机运动方向为 CW
  - `0258` = 速度为 600.0RPM
  - `64` = 加速度为 100；(加速度计算公式见"5.3.7 速度模式控制（Emm）")
  - `01` = 使能 En 引脚控制启停

## 5.8 读取所有驱动参数命令

#### 5.8.1 读取系统状态参数（X）

**主机发送（主机→电机）**

| 地址 | 功能码 | 辅助码 | 校验码 |
| --- | --- | --- | --- |
| Addr | 43 | 7A | 6B |

**电机返回（电机→主机）**

| 地址 | 功能码 | 字节数 | 参数个数 | 总线电压 | 总线电流 | 电机相电流 | 编码器原始值 | 线性化编码器值 | 符号 1 | 电机目标位置 | 符号 2 | 电机实时转速 | 符号 3 | 电机实时位置 | 符号 4 | 电机位置误差 | 符号 5 | 电机实时温度 | 回零状态标志 | 电机状态标志 | 校验码 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Addr | 43 | 25 | 0C | 0000-FFFF | 0000-FFFF | 0000-FFFF | 0000-FFFF | 0000-FFFF | 0000-FFFF | 00000000-FFFFFFFF | 0000-FFFF | 0000-7530 | 0000-FFFF | 00000000-FFFFFFFF | 00000000-FFFFFFFF | 00-FF | 参考 5.4.4 | 参考 5.5.15 | 6B |

**参数说明：**
- 字节数：总字节数为 0x25 = 37 个字节
- 参数个数：总的参数个数为 0x0C = 12 个参数
- 总线电压：电源电压，即 V+引脚经过二极管后的供电电压，单位：mV
- 总线电流：电源电流，即 V+引脚经过二极管后的供电电流，单位：mA
- 电机相电流：电机实时相电流，单位：mA